const source=new EventSource("/events");function buildEntityUrl(t,e){if(t.dataset.domain){const n=t.dataset.domain,s=encodeURIComponent(t.dataset.name),o=t.dataset.device;return o?"/"+n+"/"+encodeURIComponent(o)+"/"+s+"/"+e:"/"+n+"/"+s+"/"+e}const n=t.id.split("-");return"/"+n[0]+"/"+n.slice(1).join("-")+"/"+e}source.addEventListener("log",(function(t){const e=document.getElementById("log");let n=[["[1;31m","e"],["[0;33m","w"],["[0;32m","i"],["[0;35m","c"],["[0;36m","d"],["[0;37m","v"]],s="",o="";for(const e of n)t.data.startsWith(e[0])&&(s=e[1],o=e[0]);if(""==s)return void(e.innerHTML+=t.data+"\n");const c=t.data.substr(7,t.data.length-11).split("\n");let a="";const i=c[0].match(/^(.*?\]:)/);i&&(a=i[1]),c.forEach(((t,n)=>{t&&(e.innerHTML+=0===n?'<span class="'+s+'">'+t+"</span>\n":'<span class="'+s+'">'+a+t+"</span>\n")}))})),actions=[["switch",["toggle"]],["light",["toggle"]],["fan",["toggle"]],["cover",["open","close"]],["button",["press"]],["lock",["lock","unlock","open"]]],multi_actions=[["select","option"],["number","value"]],source.addEventListener("state",(function(t){const e=JSON.parse(t.data),n=e.name_id||e.id;let s=document.getElementById(n);if(!s&&n.includes("/")){const t=n.split("/"),e=t[0];if(3===t.length){const n=CSS.escape(t[1]),o=CSS.escape(t[2]);s=document.querySelector(`tr[data-domain="${e}"][data-device="${n}"][data-name="${o}"]`)}else{const n=CSS.escape(t[1]);s=document.querySelector(`tr[data-domain="${e}"][data-name="${n}"]:not([data-device])`)}}s&&void 0!==e.state&&(s.children[1].innerText=e.state)}));const states=document.getElementById("states");for(let t=0;t<states.rows.length;t++){const e=states.rows[t];if(e.children[2].children.length){for(const t of actions)if(e.classList.contains(t[0]))for(let n=0;n<e.children[2].children.length&&n<t[1].length;n++){const s=t[1][n];e.children[2].children[n].addEventListener("click",(function(){const t=new XMLHttpRequest;t.open("POST",buildEntityUrl(e,s),!0),t.send()}))}for(const t of multi_actions)if(e.classList.contains(t[0])){const n=t[1];e.children[2].children[0].addEventListener("change",(function(){const t=new XMLHttpRequest;t.open("POST",buildEntityUrl(e,"set")+"?"+n+"="+encodeURIComponent(this.value),!0),t.send()}))}}}